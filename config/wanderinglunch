upstream wanderinglunch {
  server 127.0.0.1:3000;
}

upstream node {
  server 127.0.0.1:3001;
}

server_names_hash_bucket_size 64;

proxy_cache_path /data/nginx/cache levels=1:2 keys_zone=STATIC:10m
                                   inactive=23h max_size=1g;
proxy_temp_path /data/nginx/temp;

server {
  listen 80;
  server_name wanderinglunch.com;

  location / {
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded_for $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-NginX-proxy true;
    gzip on;
    gzip_static on;
    
    
    proxy_cache STATIC;
    proxy_cache_valid 200 5m;
    proxy_cache_valid 404  1m;
    proxy_cache_use_stale error timeout invalid_header updating
                          http_500 http_502 http_503 http_504;
    proxy_cache_bypass $http_secret_header;
    
    add_header X-Cache-Status $upstream_cache_status;

    proxy_pass http://node;
    proxy_redirect off;
  } 

   #location ~* ^.+\.(png|jpeg|jpg|gif)$ {
   #  root /wanderinglunch/public; 
   #  access_log on;
   #  expires max;
   #  error_page 404 /images/spacer.gif;
   #}

  #location ~^/(img) {
  #  root /home/pepp/bundle/static;
    #root /foodtruck/img;
  #  access_log off;
  #  expires max;
  #  error_page 404 /img/spacer.gif;
  #  add_header Pragma public;
    #add_header Cache-Control "public, must-revalidate, proxy-revalidate";
  #}

}

server {
  listen 80;
  server_name www.wanderinglunch.com;
  return 301 http://wanderinglunch.com;
}
